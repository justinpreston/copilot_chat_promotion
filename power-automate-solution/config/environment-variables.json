{
  "environmentVariables": [
    {
      "schemaName": "ccp_TenantId",
      "displayName": "Tenant ID",
      "description": "Your Microsoft 365 tenant ID (GUID). Find this in Azure Portal > Microsoft Entra ID > Overview.",
      "type": "String",
      "isRequired": true,
      "defaultValue": "",
      "exampleValue": "12345678-1234-1234-1234-123456789012"
    },
    {
      "schemaName": "ccp_ClientId",
      "displayName": "App Client ID",
      "description": "Azure AD App Registration Client ID with Microsoft Graph permissions for Chat.Create and Chat.ReadWrite.All",
      "type": "String",
      "isRequired": true,
      "defaultValue": "",
      "exampleValue": "abcd1234-abcd-1234-abcd-1234abcd5678"
    },
    {
      "schemaName": "ccp_ClientSecret",
      "displayName": "App Client Secret",
      "description": "Azure AD App Registration Client Secret. This is a sensitive value - store securely.",
      "type": "Secret",
      "isRequired": true,
      "defaultValue": "",
      "exampleValue": "your-client-secret-value",
      "securityNote": "This secret should be stored in Azure Key Vault for production deployments."
    },
    {
      "schemaName": "ccp_SharePointSiteUrl",
      "displayName": "SharePoint Site URL",
      "description": "URL of the SharePoint site containing the CopilotPromotionUsers list",
      "type": "String",
      "isRequired": true,
      "defaultValue": "",
      "exampleValue": "https://contoso.sharepoint.com/sites/CopilotPromotion"
    },
    {
      "schemaName": "ccp_DefaultCampaignWeek",
      "displayName": "Default Campaign Week",
      "description": "Default week number for campaign sends (1-4). Can be overridden at runtime.",
      "type": "String",
      "isRequired": false,
      "defaultValue": "1",
      "allowedValues": ["1", "2", "3", "4"]
    },
    {
      "schemaName": "ccp_DefaultUserType",
      "displayName": "Default User Type",
      "description": "Default user type for card selection. Licensed = M365 Copilot users, NonLicensed = Copilot Chat Web users.",
      "type": "String",
      "isRequired": false,
      "defaultValue": "Licensed",
      "allowedValues": ["Licensed", "NonLicensed"]
    }
  ],
  "connectionReferences": [
    {
      "name": "shared_sharepointonline",
      "displayName": "SharePoint",
      "description": "Connection to SharePoint for reading/writing the user list",
      "connectorId": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline",
      "connectionType": "StandardConnection",
      "required": true
    }
  ],
  "setupInstructions": {
    "step1_createAppRegistration": {
      "title": "Create Azure AD App Registration",
      "steps": [
        "Go to Azure Portal > Microsoft Entra ID > App registrations",
        "Click 'New registration'",
        "Name: 'Copilot Chat Promotion Flow'",
        "Supported account types: 'Accounts in this organizational directory only'",
        "Click 'Register'",
        "Copy the 'Application (client) ID' - this is your ClientId",
        "Copy the 'Directory (tenant) ID' - this is your TenantId"
      ]
    },
    "step2_configurePermissions": {
      "title": "Configure API Permissions",
      "steps": [
        "In the app registration, go to 'API permissions'",
        "Click 'Add a permission' > 'Microsoft Graph' > 'Application permissions'",
        "Add: Chat.Create, Chat.ReadWrite.All, User.Read.All",
        "Click 'Grant admin consent for [your tenant]'",
        "Wait for green checkmarks to appear"
      ],
      "permissions": [
        {
          "api": "Microsoft Graph",
          "permission": "Chat.Create",
          "type": "Application",
          "description": "Create chats with users"
        },
        {
          "api": "Microsoft Graph",
          "permission": "Chat.ReadWrite.All",
          "type": "Application",
          "description": "Send messages to chats"
        },
        {
          "api": "Microsoft Graph",
          "permission": "User.Read.All",
          "type": "Application",
          "description": "Read user profiles (for validation)"
        }
      ]
    },
    "step3_createClientSecret": {
      "title": "Create Client Secret",
      "steps": [
        "In the app registration, go to 'Certificates & secrets'",
        "Click 'New client secret'",
        "Description: 'Copilot Promotion Flow'",
        "Expiration: Choose based on your policy (recommend 12-24 months)",
        "Click 'Add'",
        "IMMEDIATELY copy the 'Value' - this is your ClientSecret",
        "Note: You won't be able to see this value again!"
      ]
    },
    "step4_createSharePointSite": {
      "title": "Create SharePoint Site and List",
      "steps": [
        "Create a new SharePoint site or use an existing one",
        "Create a list named 'CopilotPromotionUsers'",
        "Add columns as defined in CopilotPromotionUsers-ListSchema.json",
        "Copy the site URL (e.g., https://contoso.sharepoint.com/sites/CopilotPromotion)"
      ]
    },
    "step5_importSolution": {
      "title": "Import Power Platform Solution",
      "steps": [
        "Go to make.powerautomate.com",
        "Click 'Solutions' in left nav",
        "Click 'Import solution'",
        "Upload the CopilotChatPromotion.zip file",
        "Configure environment variables when prompted",
        "Create or select SharePoint connection",
        "Click 'Import'"
      ]
    }
  }
}
